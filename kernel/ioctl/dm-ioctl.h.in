/*
 * Copyright (C) 2001 Sistina Software (UK) Limited.
 *
 * This file is released under the LGPL.
 */

#ifndef _LINUX_DM_IOCTL_H
#define _LINUX_DM_IOCTL_H

#include "device-mapper.h"

/*
 * Implements a traditional ioctl interface to the device mapper.
 */

/*
 * All ioctl arguments consist of a single chunk of memory, with
 * this structure at the start.
 */
struct dm_ioctl {
	char version[16];

	unsigned long data_size;	/* total size of data passed in */
					/* including this struct */

	unsigned long data_start;	/* offset to start of data */
					/* relative to start of this struct */

	char name[DM_NAME_LEN];		/* device name */

	unsigned int target_count;	/* in/out */
	unsigned int open_count;	/* out */
	unsigned int flags;		/* in/out */

	__kernel_dev_t dev;		/* in/out */
};

/*
 * Used to specify tables.  These structures appear after the
 * dm_ioctl.
 */
struct dm_target_spec {
	int32_t status;		/* used when reading from kernel only */
	unsigned long long sector_start;
	unsigned long long length;

	char target_type[DM_MAX_TYPE_NAME];

	unsigned long next;	/* offset in bytes to next target_spec */

	/*
	 * Parameter string starts immediately after this object.
	 * Be careful to add padding after string to ensure correct
	 * alignment of subsequent dm_target_spec.
	 */
};


/*
 * Used to retrieve target dependencies
 */
struct dm_target_deps {
	unsigned int count;

	__kernel_dev_t dev[0];		/* out */
};


#define DM_IOCTL 0xfd

#define	DM_CREATE _IOWR(DM_IOCTL, 0x00, struct dm_ioctl)
#define	DM_REMOVE _IOW(DM_IOCTL, 0x01, struct dm_ioctl)
#define	DM_SUSPEND _IOW(DM_IOCTL, 0x02, struct dm_ioctl)
#define	DM_RELOAD _IOW(DM_IOCTL, 0x03, struct dm_ioctl)
#define DM_INFO _IOWR(DM_IOCTL, 0x04, struct dm_ioctl)
#define DM_RENAME _IOW(DM_IOCTL, 0x05, struct dm_ioctl)
#define DM_VERSION _IOR(DM_IOCTL, 0x06, struct dm_ioctl)
#define DM_DEPS _IOR(DM_IOCTL, 0x07, struct dm_ioctl)

#define DM_IOCTL_VERSION @DM_IOCTL_VERSION@
#define DM_DRIVER_VERSION @DM_DRIVER_VERSION@

/* Status bits */
#define DM_READONLY_FLAG	0x00000001
#define DM_SUSPEND_FLAG		0x00000002
#define DM_EXISTS_FLAG		0x00000004
#define DM_PERSISTENT_DEV_FLAG	0x00000008

#endif /* _LINUX_DM_IOCTL_H */
